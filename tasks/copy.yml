---

- name: Create directory for installation {{ rcb_bin_dir }}
  file: >
    state="directory"
    path="{{ rcb_bin_dir }}"

- name: Find scripts in {{ rcb_source_dest }}/rcb/
  find: >
    paths="{{ rcb_source_dest }}/rcb/"
    recurse="yes"
    patterns="*.sh"
  register: command_result

- name: Copy scripts to {{ rcb_bin_dir }}
  copy: >
    src="{{ item.path }}"
    dest="{{ rcb_bin_dir }}"
    remote_src="yes"
    owner="root"
    group="root"
    mode="0750"
  with_items: "{{ command_result.files }}"
  
# TODO: use template for idempotence
- name: Copy rcb configuration to {{ rcb_etc_dir }}/{{ rcb_rcb_conf }}
  copy: >
    src="{{ rcb_source_dest }}/rcb/rcb.conf.ubuntu"
    dest="{{ rcb_etc_dir }}/{{ rcb_rcb_conf }}"
    remote_src="yes"
    owner="root"
    group="root"
    mode="0640"

# TODO: use template for idempotence
- name: Copy rsnapshot configuration to {{ rcb_etc_dir }}/{{ rcb_rsnapshot_conf }}
  copy: >
    src="{{ rcb_source_dest }}/rcb/rsnapshot.conf.ubuntu"
    dest="{{ rcb_etc_dir }}/{{ rcb_rsnapshot_conf }}"
    remote_src="yes"
    owner="root"
    group="root"
    mode="0640"

# EOF
...
